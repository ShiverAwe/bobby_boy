bobby_boy
===

### Предназначение

Получение данных по кассовым чекам через распознавание QR-кодов и запросы к ОФД с занесением трат в систему [Drebedengi.ru](http://drebedengi.ru).

### Рабочий сценарий

1. Запускаете программу
1. Подносите чек к веб-камере
	- распознаётся строка с данными чека с QR-кода
	- поочередно у всех ОФД запрашивается чек
	- данные сохраняются в сыром виде и в CSV-таблице
	- происходит вход в Drebedengi, подтягиваются категории, проверяется наличие СМС по чеку 
	- открывается табличный редактор
1. Проверяете список, редактируете категории трат или просто нажимаете Enter
	- список трат импортируется в Дребеденьги
	- если была СМС по чеку с общей суммой, то она удаляется

При редактировании в файле отображаются доступные категории трат, которые можно копировать в 
соответствующие позиции в чеке. 

### Поддерживаемые ОФД

Официальный список операторов фискальных данных расположен [здесь](https://www.nalog.ru/rn77/related_activities/registries/fiscaloperators/).

На 06.08.2017 из 12 ОФД публичный API для проверки кассовых чеков есть у 9. 

Приложение умеет работает с ОФД (по ссылкам страницы с формами проверки):
- [Первый ОФД](https://consumer.1-ofd.ru/#/landing) (Ашан, Виктория, Пятёрочка, BILLA, Магнит)
- [Платформа ОФД](https://lk.platformaofd.ru/web/noauth/cheque/search) (Дикси, Крошка-картошка)
- [Такском](https://receipt.taxcom.ru/) (Карусель, KFC)
- [OFD.RU](https://ofd.ru/checkinfo) (Связной) - потребуется ручной ввод РН ККТ и ИНН с чека
- [ОФД-Я](https://ofd-ya.ru/check) (Перекрёсток) - потребуется ручной ввод РН ККТ с чека (ИНН необязателен)
- ~~[Астрал ОФД](https://ofd.astralnalog.ru/)~~
- ~~[ОФД Яндекс](https://ofd.yandex.ru/check)~~
- ~~[СБИС](https://ofd.sbis.ru/)~~
- ~~[КОРУС ОФД](https://ofd.esphere.ru/CheckWebApp/fiscaldocsearch.zul)~~

### Использование

Для выполнения программы достаточно запустить `main.py`. 

По умолчанию происходит распознавание QR-кода через веб-камеру. Для ручного ввода уже распознанного текста следует добавить ключ запуска `--text`.

При первом запуске необходимо скопировать `config_template.py` в `config.py` и ввести свои данные:
- Логин и пароль от аккаунта в Дребеденьгах
- Валюту
- Место списания (счёт) 
- Категорию трат по умолчанию
- Путь к приложению для редактирования таблиц (e.g. LibreOffice, OpenOffice, Excel)

### Установка

Необходим `Python 2.7`, фреймворки Pygame и ZBar и дополнительные библиотеки.

Работа проверена на Ubuntu Linux 16.04, для установки выполнить:
```
sudo apt-get build-dep python-pygame && sudo apt-get install python-dev
pip install -r requirements.txt
```

### Тестирование

```
python -m unittest discover
```

### Обсуждение

Отзывы и предложения по программе отправлять в соответствующую [ветку форума Drebedengi.ru](https://www.drebedengi.ru/?module=forumMessageList&topic_id=8486).